{"version":3,"file":"SimpleStoreIDB.js","sources":["../../src/databases/SimpleStoreIDB.ts"],"sourcesContent":["import { deleteDB, openDB, type IDBPDatabase } from \"idb\";\r\nimport { SimpleStoreBase } from \"./SimpleStoreBase\";\r\nimport { fireAndForget } from \"../promises\";\r\n\r\n/**\r\n * Represents a simple store using IndexedDB.\r\n * @template T - The type of the values stored in the store.\r\n */\r\nexport class SimpleStoreIDB<T> extends SimpleStoreBase<T> {\r\n\r\n    name: string;\r\n    constructor(name: string) {\r\n        super();\r\n        this.name = name;\r\n        this.initDB(name);\r\n    }\r\n    db?: Promise<IDBPDatabase<any>>;\r\n\r\n    initDB(name: string) {\r\n        this.db = openDB(name, 1, {\r\n            upgrade(db) {\r\n                db.createObjectStore(name);\r\n            },\r\n        });\r\n    }\r\n\r\n    async get(key: string): Promise<T | undefined> {\r\n        if (this.db == undefined) throw new Error(\"Database not initialized or already destroyed\");\r\n        return await (await this.db).get(this.name, key);\r\n    }\r\n\r\n    async set(key: string, value: T): Promise<void> {\r\n        if (this.db == undefined) throw new Error(\"Database not initialized or already destroyed\");\r\n        return await (await this.db).put(this.name, value, key);\r\n    }\r\n\r\n    async delete(key: string): Promise<void> {\r\n        if (this.db == undefined) throw new Error(\"Database not initialized or already destroyed\");\r\n        return await (await this.db).delete(this.name, key);\r\n    }\r\n    async keys(from?: string | undefined, to?: string | undefined, count?: number | undefined): Promise<string[]> {\r\n        if (this.db == undefined) throw new Error(\"Database not initialized or already destroyed\");\r\n        const range = from && to ? IDBKeyRange.bound(from, to) : from ? IDBKeyRange.lowerBound(from) : to ? IDBKeyRange.upperBound(to) : undefined;\r\n        return await (await this.db).getAllKeys(this.name, range, count);\r\n    }\r\n    async keysIDB(query?: IDBValidKey | IDBKeyRange, count?: number): Promise<IDBValidKey[]> {\r\n        if (this.db == undefined) throw new Error(\"Database not initialized or already destroyed\");\r\n        return await (await this.db).getAllKeys(this.name, query, count);\r\n    }\r\n\r\n    async clear(): Promise<void> {\r\n        if (this.db == undefined) throw new Error(\"Database not initialized or already destroyed\");\r\n        return (await this.db).clear(this.name);\r\n    }\r\n\r\n    close(): void {\r\n        fireAndForget(async () => {\r\n            if (this.db == undefined) throw new Error(\"Database not initialized or already destroyed\");\r\n            (await this.db).close()\r\n            this.db = undefined!;\r\n        });\r\n    }\r\n\r\n\r\n    async destroy(): Promise<void> {\r\n        if (this.db == undefined) throw new Error(\"Database not initialized or already destroyed\");\r\n        (await this.db).close()\r\n        this.db = undefined!;\r\n        return await deleteDB(this.name);\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAIA;;;AAGG;AACG,MAAO,cAAkB,SAAQ,eAAkB,CAAA;AAGrD,IAAA,WAAA,CAAY,IAAY,EAAA;AACpB,QAAA,KAAK,EAAE,CAAC;AAFZ,QAAA,MAAA,CAAA,cAAA,CAAA,IAAA,EAAA,MAAA,EAAA;;;;;AAAa,SAAA,CAAA,CAAA;AAMb,QAAA,MAAA,CAAA,cAAA,CAAA,IAAA,EAAA,IAAA,EAAA;;;;;AAAgC,SAAA,CAAA,CAAA;AAH5B,QAAA,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;AACjB,QAAA,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KACrB;AAGD,IAAA,MAAM,CAAC,IAAY,EAAA;QACf,IAAI,CAAC,EAAE,GAAG,MAAM,CAAC,IAAI,EAAE,CAAC,EAAE;AACtB,YAAA,OAAO,CAAC,EAAE,EAAA;AACN,gBAAA,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;aAC9B;AACJ,SAAA,CAAC,CAAC;KACN;IAED,MAAM,GAAG,CAAC,GAAW,EAAA;AACjB,QAAA,IAAI,IAAI,CAAC,EAAE,IAAI,SAAS;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;AAC3F,QAAA,OAAO,MAAM,CAAC,MAAM,IAAI,CAAC,EAAE,EAAE,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;KACpD;AAED,IAAA,MAAM,GAAG,CAAC,GAAW,EAAE,KAAQ,EAAA;AAC3B,QAAA,IAAI,IAAI,CAAC,EAAE,IAAI,SAAS;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;AAC3F,QAAA,OAAO,MAAM,CAAC,MAAM,IAAI,CAAC,EAAE,EAAE,GAAG,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;KAC3D;IAED,MAAM,MAAM,CAAC,GAAW,EAAA;AACpB,QAAA,IAAI,IAAI,CAAC,EAAE,IAAI,SAAS;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;AAC3F,QAAA,OAAO,MAAM,CAAC,MAAM,IAAI,CAAC,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;KACvD;AACD,IAAA,MAAM,IAAI,CAAC,IAAyB,EAAE,EAAuB,EAAE,KAA0B,EAAA;AACrF,QAAA,IAAI,IAAI,CAAC,EAAE,IAAI,SAAS;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;QAC3F,MAAM,KAAK,GAAG,IAAI,IAAI,EAAE,GAAG,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,CAAC,GAAG,IAAI,GAAG,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,WAAW,CAAC,UAAU,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC;AAC3I,QAAA,OAAO,MAAM,CAAC,MAAM,IAAI,CAAC,EAAE,EAAE,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;KACpE;AACD,IAAA,MAAM,OAAO,CAAC,KAAiC,EAAE,KAAc,EAAA;AAC3D,QAAA,IAAI,IAAI,CAAC,EAAE,IAAI,SAAS;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;AAC3F,QAAA,OAAO,MAAM,CAAC,MAAM,IAAI,CAAC,EAAE,EAAE,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;KACpE;AAED,IAAA,MAAM,KAAK,GAAA;AACP,QAAA,IAAI,IAAI,CAAC,EAAE,IAAI,SAAS;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;AAC3F,QAAA,OAAO,CAAC,MAAM,IAAI,CAAC,EAAE,EAAE,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KAC3C;IAED,KAAK,GAAA;QACD,aAAa,CAAC,YAAW;AACrB,YAAA,IAAI,IAAI,CAAC,EAAE,IAAI,SAAS;AAAE,gBAAA,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;YAC3F,CAAC,MAAM,IAAI,CAAC,EAAE,EAAE,KAAK,EAAE,CAAA;AACvB,YAAA,IAAI,CAAC,EAAE,GAAG,SAAU,CAAC;AACzB,SAAC,CAAC,CAAC;KACN;AAGD,IAAA,MAAM,OAAO,GAAA;AACT,QAAA,IAAI,IAAI,CAAC,EAAE,IAAI,SAAS;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAC;QAC3F,CAAC,MAAM,IAAI,CAAC,EAAE,EAAE,KAAK,EAAE,CAAA;AACvB,QAAA,IAAI,CAAC,EAAE,GAAG,SAAU,CAAC;AACrB,QAAA,OAAO,MAAM,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACpC;AACJ;;;;"}