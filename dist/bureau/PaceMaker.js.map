{"version":3,"file":"PaceMaker.js","sources":["../../src/bureau/PaceMaker.ts"],"sourcesContent":["export class PaceMaker {\n    public _interval: number;\n    public _minimumNext: number | undefined;\n\n    constructor(interval: number) {\n        this._interval = interval;\n    }\n\n    /**\n     * Change the interval of the pacing.\n     * This will reset the minimum next pacing time.\n     * @param interval \n     */\n    changeInterval(interval: number) {\n        if (interval !== this._interval) {\n            this._interval = interval;\n            this._minimumNext = undefined;\n        }\n    }\n\n    /**\n     * Mark the current time as the basis for the next pacing.\n     * @param now \n     */\n    mark(now: number = Date.now()) {\n        if (this._minimumNext === undefined) {\n            this._minimumNext = now + this._interval;\n        } else {\n            this._minimumNext = Math.max(this._minimumNext + this._interval, now + this._interval);\n        }\n    }\n\n    _getPaced(doMark: boolean) {\n        const now = Date.now();\n        const prevMinimum = this._minimumNext;\n        if (doMark) this.mark(now);\n        if (prevMinimum !== undefined) {\n            const shouldWait = prevMinimum - now;\n            if (shouldWait > 0) {\n                return new Promise<void>(resolve => setTimeout(() => {\n                    resolve();\n                }, shouldWait));\n            }\n        }\n        return Promise.resolve();\n    }\n\n    /**\n     * The promise for waiting paced\n     */\n    get paced() {\n        return this._getPaced(true);\n    }\n    /**\n     * The promise for waiting paced since the last mark\n     */\n    get pacedSinceMark() {\n        return this._getPaced(false);\n    }\n}"],"names":[],"mappings":"MAAa,SAAS,CAAA;AAIlB,IAAA,WAAA,CAAY,QAAgB,EAAA;AAHrB,QAAA,MAAA,CAAA,cAAA,CAAA,IAAA,EAAA,WAAA,EAAA;;;;;AAAkB,SAAA,CAAA;AAClB,QAAA,MAAA,CAAA,cAAA,CAAA,IAAA,EAAA,cAAA,EAAA;;;;;AAAiC,SAAA,CAAA;AAGpC,QAAA,IAAI,CAAC,SAAS,GAAG,QAAQ;;AAG7B;;;;AAIG;AACH,IAAA,cAAc,CAAC,QAAgB,EAAA;AAC3B,QAAA,IAAI,QAAQ,KAAK,IAAI,CAAC,SAAS,EAAE;AAC7B,YAAA,IAAI,CAAC,SAAS,GAAG,QAAQ;AACzB,YAAA,IAAI,CAAC,YAAY,GAAG,SAAS;;;AAIrC;;;AAGG;AACH,IAAA,IAAI,CAAC,GAAA,GAAc,IAAI,CAAC,GAAG,EAAE,EAAA;AACzB,QAAA,IAAI,IAAI,CAAC,YAAY,KAAK,SAAS,EAAE;YACjC,IAAI,CAAC,YAAY,GAAG,GAAG,GAAG,IAAI,CAAC,SAAS;;aACrC;YACH,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,EAAE,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC;;;AAI9F,IAAA,SAAS,CAAC,MAAe,EAAA;AACrB,QAAA,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE;AACtB,QAAA,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY;AACrC,QAAA,IAAI,MAAM;AAAE,YAAA,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC;AAC1B,QAAA,IAAI,WAAW,KAAK,SAAS,EAAE;AAC3B,YAAA,MAAM,UAAU,GAAG,WAAW,GAAG,GAAG;AACpC,YAAA,IAAI,UAAU,GAAG,CAAC,EAAE;gBAChB,OAAO,IAAI,OAAO,CAAO,OAAO,IAAI,UAAU,CAAC,MAAK;AAChD,oBAAA,OAAO,EAAE;AACb,iBAAC,EAAE,UAAU,CAAC,CAAC;;;AAGvB,QAAA,OAAO,OAAO,CAAC,OAAO,EAAE;;AAG5B;;AAEG;AACH,IAAA,IAAI,KAAK,GAAA;AACL,QAAA,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;;AAE/B;;AAEG;AACH,IAAA,IAAI,cAAc,GAAA;AACd,QAAA,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;;AAEnC;;;;"}